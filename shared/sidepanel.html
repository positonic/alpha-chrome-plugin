<!DOCTYPE html>
<html>
  <head>
    <title>Voice Dictation</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        padding: 16px;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        margin: 0;
        min-height: 100vh;
        box-sizing: border-box;
      }
      button {
        margin-bottom: 12px;
        padding: 12px 20px;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        width: 100%;
        transition: all 0.2s ease;
      }
      button:hover {
        transform: translateY(-1px);
      }
      button:active {
        transform: translateY(0);
      }
      button:disabled {
        background: #e5e7eb !important;
        color: #9ca3af;
        cursor: not-allowed;
        box-shadow: none !important;
        transform: none;
      }
      .btn-primary {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
        box-shadow: 0 6px 16px rgba(5, 150, 105, 0.4);
      }
      .btn-recording {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
      }
      .btn-continue {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }
      .btn-continue:hover {
        background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
      }
      .btn-new-recording {
        font-size: 12px;
        padding: 6px 12px;
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 4px;
      }
      .btn-new-recording:hover {
        background: #e5e7eb;
      }
      #output {
        white-space: pre-wrap;
        margin: 0;
        padding: 16px;
        background: white;
        border-radius: 8px;
        min-height: 150px;
        flex: 1;
        line-height: 1.6;
        border: 2px solid #e5e7eb;
        font-size: 14px;
        color: #374151;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        overflow-y: auto;
        overflow-x: hidden;
        word-wrap: break-word;
        box-sizing: border-box;
      }
      #output:focus {
        outline: none;
        border-color: #2D68E5;
        box-shadow: 0 0 0 3px rgba(45, 104, 229, 0.1);
      }
      #output:empty::before {
        content: 'Start a new recording or select one to continue...';
        color: #9ca3af;
        pointer-events: none;
      }
      .status-bar {
        background: white;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 12px;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        border: 2px solid #e5e7eb;
      }
      .listening {
        color: #2D68E5;
        font-weight: 600;
      }

      /* Panel tabs (Save Page / Recording) */
      .panel-tabs {
        display: none;
      }
      .panel-tabs.visible {
        display: flex;
        gap: 0;
        margin-bottom: 14px;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid #e5e7eb;
        background: white;
      }
      .panel-tabs button {
        flex: 1;
        margin: 0;
        padding: 12px 14px;
        border-radius: 0;
        font-size: 13px;
        font-weight: 600;
        background: white;
        color: #6b7280;
        box-shadow: none;
        border: none;
        transition: all 0.15s ease;
      }
      .panel-tabs button:hover {
        transform: none;
        background: #f3f4f6;
      }
      .panel-tabs button.active {
        background: #2D68E5;
        color: white;
      }

      /* Tab content panels */
      .tab-panel {
        display: none;
      }
      .tab-panel.active {
        display: block;
      }

      /* Shared project selector (above tabs) */
      .shared-project-selector {
        display: none;
        margin-bottom: 12px;
      }
      .shared-project-selector.visible {
        display: block;
      }
      .shared-select {
        width: 100%;
        padding: 10px 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 13px;
        background: white;
        transition: border-color 0.2s ease;
        box-sizing: border-box;
        margin-bottom: 8px;
        color: #374151;
      }
      .shared-select:focus {
        outline: none;
        border-color: #2D68E5;
        box-shadow: 0 0 0 3px rgba(45, 104, 229, 0.1);
      }

      /* Save page */
      .save-page-input {
        width: 100%;
        padding: 10px 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        background: white;
        transition: border-color 0.2s ease;
        box-sizing: border-box;
        margin-bottom: 10px;
      }
      .save-page-input:focus {
        outline: none;
        border-color: #2D68E5;
        box-shadow: 0 0 0 3px rgba(45, 104, 229, 0.1);
      }
      .btn-save-page {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
      }
      .btn-save-page:hover {
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
        box-shadow: 0 6px 16px rgba(5, 150, 105, 0.4);
      }
      .save-page-status {
        font-size: 13px;
        font-weight: 500;
        min-height: 18px;
        margin-top: 4px;
      }
      .save-page-status.success { color: #059669; }
      .save-page-status.error { color: #dc3545; }

      /* Create Action */
      .create-action-desc {
        resize: vertical;
        font-family: inherit;
        line-height: 1.5;
        min-height: 60px;
      }
      .create-action-priority {
        margin-bottom: 10px;
      }
      .btn-create-action {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
      }
      .btn-create-action:hover {
        background: linear-gradient(135deg, #6d28d9 0%, #5b21b6 100%);
        box-shadow: 0 6px 16px rgba(124, 58, 237, 0.4);
      }

      /* Model progress */
      .model-status {
        margin-bottom: 12px;
        display: none;
      }
      .model-status.visible {
        display: block;
      }
      .progress-bar-bg {
        background: #e5e7eb;
        border-radius: 4px;
        height: 6px;
        overflow: hidden;
        margin-top: 6px;
      }
      .progress-bar-fill {
        background: linear-gradient(90deg, #447AED, #2D68E5);
        height: 100%;
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 4px;
      }
      .model-status-text {
        font-size: 12px;
        color: #6b7280;
      }

      .output-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .output-label {
        color: #6b7280;
        font-size: 13px;
        font-weight: 500;
      }
      #session-url {
        display: none;
        color: #2D68E5;
        text-decoration: none;
        font-size: 12px;
        font-weight: 500;
      }

      /* Annotation controls */
      .annotation-controls {
        display: flex;
        gap: 6px;
        margin-bottom: 12px;
        align-items: center;
      }
      .btn-draw {
        background: white;
        color: #374151;
        border: 2px solid #e5e7eb;
        box-shadow: none;
        flex-shrink: 0;
        width: auto;
        padding: 10px 16px;
        margin-bottom: 0;
      }
      .btn-draw:hover {
        background: #f3f4f6;
        border-color: #d1d5db;
        transform: none;
      }
      .btn-draw.active {
        background: #2D68E5;
        color: white;
        border-color: #2D68E5;
        box-shadow: 0 4px 12px rgba(45, 104, 229, 0.3);
      }
      .tool-toggle {
        display: none;
        gap: 0;
        border-radius: 6px;
        overflow: hidden;
        border: 2px solid #e5e7eb;
        background: white;
      }
      .tool-toggle.visible {
        display: flex;
      }
      .tool-toggle button {
        flex: 1;
        margin: 0;
        padding: 8px 10px;
        border-radius: 0;
        font-size: 11px;
        font-weight: 600;
        background: white;
        color: #6b7280;
        box-shadow: none;
        border: none;
        width: auto;
      }
      .tool-toggle button:hover {
        transform: none;
        background: #f3f4f6;
      }
      .tool-toggle button.active {
        background: #2D68E5;
        color: white;
      }
      .btn-clear {
        background: #6b7280 !important;
        color: white !important;
        flex-shrink: 0;
        width: auto;
        padding: 8px 12px;
        margin-bottom: 0;
        font-size: 11px;
      }
      .btn-clear:hover {
        background: #4b5563 !important;
      }

      /* Setup section */
      .setup-card {
        background: white;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        border: 2px solid #e5e7eb;
        margin-bottom: 12px;
      }
      .setup-card h2 {
        margin: 0 0 12px 0;
        font-size: 16px;
        font-weight: 600;
        color: #374151;
      }
      .setup-input {
        width: 100%;
        padding: 10px 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        background: white;
        transition: border-color 0.2s ease;
        box-sizing: border-box;
        margin-bottom: 10px;
      }
      .setup-input:focus {
        outline: none;
        border-color: #2D68E5;
        box-shadow: 0 0 0 3px rgba(45, 104, 229, 0.1);
      }
      .setup-select {
        width: 100%;
        padding: 10px 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        background: white;
        transition: border-color 0.2s ease;
        box-sizing: border-box;
        margin-bottom: 10px;
      }
      .setup-select:focus {
        outline: none;
        border-color: #2D68E5;
        box-shadow: 0 0 0 3px rgba(45, 104, 229, 0.1);
      }
      .setup-status {
        font-size: 13px;
        font-weight: 500;
        color: #059669;
        min-height: 18px;
      }
      .setup-status.error {
        color: #dc3545;
      }
      .hidden {
        display: none !important;
      }

      /* Settings header bar */
      .settings-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }
      .settings-bar .app-name {
        font-size: 14px;
        font-weight: 600;
        color: #374151;
      }
      .test-mode-badge {
        font-size: 10px;
        color: #f59e0b;
        font-weight: 600;
        margin-left: 8px;
      }
      .btn-settings {
        background: white;
        color: #6b7280;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        cursor: pointer;
        padding: 4px 10px;
        font-size: 12px;
        font-weight: 500;
        width: auto;
        margin: 0;
        transition: all 0.2s ease;
        box-shadow: none;
      }
      .btn-settings:hover {
        background: #f3f4f6;
        border-color: #d1d5db;
        color: #374151;
        transform: none;
      }

      /* Settings dropdown */
      .settings-dropdown {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .settings-dropdown .btn-danger {
        background: white;
        color: #dc3545;
        border: 2px solid #fecaca;
        font-size: 12px;
        padding: 8px 14px;
      }
      .settings-dropdown .btn-danger:hover {
        background: #fef2f2;
        border-color: #dc3545;
        transform: none;
      }

      /* Recording history list */
      .recording-history {
        margin-top: 16px;
      }
      .recording-history-header {
        font-size: 13px;
        font-weight: 500;
        color: #6b7280;
        margin-bottom: 8px;
      }
      .recording-list {
        display: flex;
        flex-direction: column;
        gap: 6px;
        max-height: 300px;
        overflow-y: auto;
      }
      .recording-item {
        padding: 10px 12px;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.15s ease;
      }
      .recording-item:hover {
        border-color: #d1d5db;
        background: #f9fafb;
      }
      .recording-item.selected {
        border-color: #2D68E5;
        background: #eff4ff;
        border-left-width: 4px;
      }
      .recording-item-title {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .recording-item-preview {
        font-size: 12px;
        color: #9ca3af;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .recording-item-time {
        font-size: 11px;
        color: #b0b7c3;
        margin-top: 2px;
      }
      /* Recording item expand arrow */
      .recording-item-header {
        display: flex;
        align-items: flex-start;
        gap: 8px;
      }
      .recording-item-header-content {
        flex: 1;
        min-width: 0;
      }
      .recording-item-arrow {
        font-size: 10px;
        color: #9ca3af;
        transition: transform 0.2s ease;
        margin-top: 3px;
        flex-shrink: 0;
      }
      .recording-item.expanded .recording-item-arrow {
        transform: rotate(90deg);
      }
      /* Actions drawer below recording item */
      .recording-actions-drawer {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.25s ease;
      }
      .recording-actions-drawer.open {
        max-height: 500px;
      }
      .recording-actions-list {
        padding: 8px 0 4px 0;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .recording-action-link {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        text-decoration: none;
        color: #374151;
        font-size: 12px;
        transition: all 0.15s ease;
        cursor: pointer;
      }
      .recording-action-link:hover {
        background: #eff4ff;
        border-color: #2D68E5;
        color: #2D68E5;
      }
      .recording-action-link-icon {
        flex-shrink: 0;
        width: 14px;
        height: 14px;
        color: #9ca3af;
      }
      .recording-action-link:hover .recording-action-link-icon {
        color: #2D68E5;
      }
      .recording-action-link-name {
        flex: 1;
        min-width: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .recording-action-link-priority {
        font-size: 10px;
        padding: 1px 6px;
        border-radius: 4px;
        font-weight: 500;
        flex-shrink: 0;
      }
      .priority-urgent { background: #fef2f2; color: #dc2626; }
      .priority-high { background: #fff7ed; color: #ea580c; }
      .priority-medium { background: #fffbeb; color: #d97706; }
      .priority-low { background: #f0fdf4; color: #16a34a; }
      .priority-quick { background: #eff6ff; color: #2563eb; }
      .recording-actions-empty {
        font-size: 11px;
        color: #9ca3af;
        padding: 6px 10px;
        text-align: center;
      }
      .recording-actions-loading {
        font-size: 11px;
        color: #9ca3af;
        padding: 6px 10px;
        text-align: center;
      }

      /* Generate Actions button */
      .btn-generate-actions {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        margin-top: 12px;
      }
      .btn-generate-actions:hover {
        background: linear-gradient(135deg, #6d28d9 0%, #5b21b6 100%);
        box-shadow: 0 6px 16px rgba(124, 58, 237, 0.4);
      }
      .btn-generate-actions.loading {
        opacity: 0.7;
        cursor: wait;
      }

      /* Actions modal overlay */
      .actions-modal-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 24px 12px;
        overflow-y: auto;
      }
      .actions-modal-overlay.hidden { display: none !important; }
      .actions-modal-card {
        background: white;
        border-radius: 12px;
        width: 100%;
        max-width: 420px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        max-height: calc(100vh - 48px);
      }
      .actions-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 16px 12px;
        border-bottom: 1px solid #e5e7eb;
      }
      .actions-modal-header h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: #374151;
      }
      .actions-modal-close-btn {
        background: none;
        border: none;
        font-size: 20px;
        color: #9ca3af;
        cursor: pointer;
        padding: 0 4px;
        width: auto;
        margin: 0;
        box-shadow: none;
      }
      .actions-modal-close-btn:hover {
        color: #374151;
        transform: none;
      }
      .actions-modal-body {
        overflow-y: auto;
        padding: 8px 0;
        flex: 1;
        min-height: 0;
      }
      .actions-modal-footer {
        padding: 12px 16px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .actions-modal-select-all {
        font-size: 12px;
        color: #6b7280;
      }
      .actions-modal-select-all label {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
      }
      .actions-modal-buttons {
        display: flex;
        gap: 8px;
      }
      .btn-modal-cancel {
        background: white;
        color: #6b7280;
        border: 2px solid #e5e7eb;
        font-size: 13px;
        padding: 8px 16px;
        width: auto;
        margin: 0;
        box-shadow: none;
      }
      .btn-modal-cancel:hover {
        background: #f3f4f6;
        border-color: #d1d5db;
        transform: none;
      }
      .btn-modal-publish {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        font-size: 13px;
        padding: 8px 16px;
        width: auto;
        margin: 0;
      }
      .btn-modal-publish:hover {
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
      }
      .btn-modal-publish:disabled {
        background: #e5e7eb !important;
        color: #9ca3af;
        box-shadow: none !important;
      }

      /* Action row in modal */
      .action-row {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 10px 16px;
        border-bottom: 1px solid #f3f4f6;
      }
      .action-row:last-child { border-bottom: none; }
      .action-row:hover { background: #f9fafb; }
      .action-row input[type="checkbox"] {
        margin-top: 3px;
        flex-shrink: 0;
      }
      .action-row-content {
        flex: 1;
        min-width: 0;
      }
      .action-edit-name {
        width: 100%;
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        border: none;
        border-bottom: 1px solid transparent;
        background: transparent;
        padding: 2px 0;
        margin-bottom: 4px;
        outline: none;
        font-family: inherit;
        box-sizing: border-box;
      }
      .action-edit-name:focus {
        border-bottom-color: #2D68E5;
      }
      .action-edit-desc {
        width: 100%;
        font-size: 12px;
        color: #6b7280;
        border: none;
        border-bottom: 1px solid transparent;
        background: transparent;
        padding: 2px 0;
        outline: none;
        font-family: inherit;
        resize: none;
        line-height: 1.4;
        box-sizing: border-box;
        overflow: hidden;
      }
      .action-edit-desc:focus {
        border-bottom-color: #2D68E5;
      }
      .action-edit-priority {
        font-size: 10px;
        font-weight: 600;
        padding: 2px 4px;
        border-radius: 4px;
        flex-shrink: 0;
        text-transform: uppercase;
        border: none;
        cursor: pointer;
        outline: none;
        appearance: none;
        -webkit-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5' viewBox='0 0 8 5'%3E%3Cpath d='M0 0l4 5 4-5z' fill='%239ca3af'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 4px center;
        padding-right: 14px;
      }
      .action-edit-priority:focus {
        box-shadow: 0 0 0 2px rgba(45, 104, 229, 0.2);
      }
      .action-edit-priority.priority-urgent { background-color: #fef2f2; color: #dc2626; }
      .action-edit-priority.priority-high { background-color: #fff7ed; color: #ea580c; }
      .action-edit-priority.priority-medium { background-color: #fefce8; color: #ca8a04; }
      .action-edit-priority.priority-low { background-color: #f0fdf4; color: #16a34a; }
      .action-edit-priority.priority-quick { background-color: #eff6ff; color: #2563eb; }
      .actions-modal-loading,
      .actions-modal-empty {
        text-align: center;
        padding: 32px 16px;
        color: #6b7280;
        font-size: 14px;
      }
      .actions-modal-error {
        text-align: center;
        padding: 24px 16px;
        color: #dc3545;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <!-- Settings bar (visible after setup) -->
    <div class="settings-bar hidden" id="settingsBar">
      <span class="app-name">
        <span id="appName"></span>
        <span class="test-mode-badge hidden" id="testModeBadge"></span>
      </span>
      <button class="btn-settings" id="settingsBtn">Settings</button>
    </div>

    <!-- Settings dropdown (toggled by settings button) -->
    <div class="settings-dropdown hidden" id="settingsDropdown">
      <div style="margin-bottom: 8px; font-size: 12px; color: #6b7280;" id="currentKeyDisplay"></div>
      <div style="display: flex; gap: 8px;">
        <button class="btn-danger" id="clearApiKeyBtn">Disconnect</button>
      </div>
    </div>

    <!-- Setup section (visible until configured) -->
    <div id="setupSection">
      <div class="setup-card hidden" id="autoAuthCard" style="text-align:center;">
        <p style="margin:0;font-size:14px;color:#6b7280;">Connecting to your account...</p>
      </div>
      <div class="setup-card" id="apiKeyCard">
        <h2>API Key Required</h2>
        <a href="https://exponential.im/settings/api-keys" target="_blank" style="display:inline-block;margin-bottom:10px;font-size:13px;color:#2D68E5;font-weight:500;">Get your API key</a>
        <input type="text" id="apiKeyInput" class="setup-input" placeholder="Enter your API key">
        <button class="btn-primary" id="saveApiKeyBtn">Save API Key</button>
        <div class="setup-status" id="apiKeyStatus"></div>
      </div>
      <div class="setup-card hidden" id="projectCard">
        <h2>Select Workspace & Project</h2>
        <select id="setupWorkspaceDropdown" class="setup-select">
          <option value="">Select a workspace...</option>
        </select>
        <select id="projectDropdown" class="setup-select">
          <option value="">Select a project...</option>
        </select>
        <div class="setup-status" id="projectStatus"></div>
      </div>
    </div>

    <!-- Dictation UI (hidden until setup complete) -->
    <div id="dictationUI" class="hidden">

    <!-- Shared workspace/project selector (above tabs) -->
    <div class="shared-project-selector" id="sharedProjectSelector">
      <select class="shared-select" id="sharedWorkspace">
        <option value="">Select workspace...</option>
      </select>
      <select class="shared-select" id="sharedProject">
        <option value="">Select project...</option>
      </select>
    </div>

    <!-- Panel-level tabs (conditionally shown by JS based on hasSavePage config) -->
    <div class="panel-tabs" id="panelTabs">
      <button id="tabSavePage" class="active">Save Page</button>
      <button id="tabCreateAction">Create Action</button>
      <button id="tabRecording">Recording</button>
    </div>

    <!-- Tab 1: Save Page -->
    <div class="tab-panel active" id="panelSavePage">
      <input type="text" class="save-page-input" id="savePageContext" placeholder="Add context (optional)...">
      <button class="btn-save-page" id="savePageBtn">Save Page</button>
      <div class="save-page-status" id="savePageStatus"></div>
    </div>

    <!-- Tab 2: Create Action -->
    <div class="tab-panel" id="panelCreateAction">
      <input type="text" class="save-page-input" id="createActionName" placeholder="Action name...">
      <textarea class="save-page-input create-action-desc" id="createActionDesc" placeholder="Description (optional)..." rows="3"></textarea>
      <select class="shared-select create-action-priority" id="createActionPriority">
        <option value="Quick">Quick</option>
        <option value="Low">Low</option>
        <option value="Medium" selected>Medium</option>
        <option value="High">High</option>
        <option value="Urgent">Urgent</option>
      </select>
      <button class="btn-create-action" id="createActionBtn">Create Action</button>
      <div class="save-page-status" id="createActionStatus"></div>
    </div>

    <!-- Tab 3: Recording (contains all existing dictation UI) -->
    <div class="tab-panel" id="panelRecording">

    <input type="text" class="save-page-input" id="recordingName" placeholder="Recording name (optional)...">

    <!-- Model download progress -->
    <div class="model-status" id="modelStatus">
      <span class="model-status-text" id="modelStatusText">Loading model...</span>
      <div class="progress-bar-bg">
        <div class="progress-bar-fill" id="modelProgressBar"></div>
      </div>
    </div>

    <div class="status-bar">Status: <span id="status">Ready</span></div>
    <button id="toggleDictation" class="btn-primary">Start Recording</button>
    <button id="newRecordingBtn" class="btn-new-recording" style="display:none;">+ New Recording</button>

    <!-- Annotation controls -->
    <div class="annotation-controls">
      <button id="toggleDraw" class="btn-draw" title="Toggle drawing mode (Ctrl+Shift+D)">Draw</button>
      <div class="tool-toggle" id="toolToggle">
        <button id="toolArrow" class="active" title="Arrow tool">Arrow</button>
        <button id="toolFreehand" title="Freehand tool">Freehand</button>
      </div>
      <button id="clearAnnotations" class="btn-clear" title="Clear all annotations" style="display:none;">Clear</button>
      <button id="screenshotBtn" class="btn-clear" title="Take a screenshot" style="margin-left: auto;">Screenshot</button>
    </div>

    <div class="output-header">
      <span class="output-label">Transcribed text:</span>
      <a id="session-url" href="#" target="_blank">View recording</a>
    </div>
    <div id="output" contenteditable="true" spellcheck="false"></div>

    <button id="generateActionsBtn" class="btn-generate-actions hidden">Generate Actions</button>

    <!-- Recording history -->
    <div class="recording-history" id="recordingHistory">
      <div class="recording-history-header">Recent Recordings</div>
      <div class="recording-list" id="recordingList"></div>
    </div>

    </div><!-- end #panelRecording -->

    </div><!-- end #dictationUI -->

    <!-- Generate Actions review modal -->
    <div id="actionsModal" class="actions-modal-overlay hidden">
      <div class="actions-modal-card">
        <div class="actions-modal-header">
          <h3>Review Actions</h3>
          <button id="actionsModalClose" class="actions-modal-close-btn">&times;</button>
        </div>
        <div class="actions-modal-body" id="actionsModalBody"></div>
        <div class="actions-modal-footer">
          <div class="actions-modal-select-all">
            <label><input type="checkbox" id="actionsSelectAll" checked> Select all</label>
          </div>
          <div class="actions-modal-buttons">
            <button id="actionsModalCancel" class="btn-modal-cancel">Cancel</button>
            <button id="actionsModalPublish" class="btn-modal-publish">Create Actions</button>
          </div>
        </div>
      </div>
    </div>

    <script src="config.js"></script>
    <script src="speech-engine-whisper.js"></script>
    <script src="sidepanel.js"></script>
  </body>
</html>
